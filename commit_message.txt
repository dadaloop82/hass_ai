fix: implement more robust conversation agent check