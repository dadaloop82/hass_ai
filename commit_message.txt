feat: implement robust, whitelist-based agent check