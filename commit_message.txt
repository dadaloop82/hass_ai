feat: improve agent check and error messages