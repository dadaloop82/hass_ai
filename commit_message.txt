fix: implement definitive and robust agent check provided by user